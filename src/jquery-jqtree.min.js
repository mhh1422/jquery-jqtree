/*Copyright (c) 2015 muhannad. MIT License*/
!function(e){var t=function(){};e.fn.hasOwnProperty("closestChild")||(e.fn.closestChild=function(t){for(var s=e(),l=this;l.length&&(s=l.filter(t),!s.length);)l=l.children();return s.first()});var s=function(t,l,a,c){var i,r,n,d,o,p=l.picker,m=l.itemRegex,f="";for(i in t){for(r=e.extend(!0,{},l.itemReplacements,t[i]),l.beforeItemProcess(r,l,a,c),n=p(r),"object"==typeof n?a>=l.expandLevels-1&&0!==l.expandLevels?(r.ul_style+=" display: none;",r.class+=" out",d=l.templates.closeItem):(r.class+=" in",d=l.templates.openItem):d=l.templates.emptyItem,r.items=s(n,l,a+1,c),l.beforeItemRender(r,l,a,c),match=m.exec(d);match;)m.lastIndex=0,o=r.hasOwnProperty(match[1])?r[match[1]]:"",d=d.replace(match[0],o),match=m.exec(d);c[r.id]=r,delete t[i],t[i]=r,f+=d}return f};functions={init:function(t){var l,a=e.extend(!0,{},e.fn.jqtree.defaults,t,e.fn.jqtree.defaults.overrides);return this.each(function(){var t,c=e.extend(!0,{},a),i=[];c.replacements.items=s(c.data,c,0,i);var r=c.templates.list;for(t=c.listRegex.exec(r);t;)c.listRegex.lastIndex=0,l=c.replacements.hasOwnProperty(t[1])?c.replacements[t[1]]:"",r=r.replace(t[0],l),t=c.listRegex.exec(r);e(this).html(r),e(this).on("click",c.handlerSelector,c.toggle),e(this).on("click",c.selectorSelector,c.select),c.treeData=i,e(this).addClass("jqtree-root").data("jqtree",c).trigger("ready",c)})},select:function(t,s,l){var a=e(this).first().closest(".jqtree-root"),c=a.data("jqtree"),i=e(a).find("#jqtree-list-item-"+t);return e(a).find("."+c.replacements.selected_class).removeClass(c.replacements.selected_class),e(i).addClass(c.replacements.selected_class),l!==!0&&e(i).trigger("selected",c.treeData[t],a,c),functions.expand.call(this,t,function(){"function"==typeof s&&s.call(this,c.treeData[t],a,c)}),this},expand:function(t,s){var l,a,c=e(this).first().closest(".jqtree-root"),i=c.data("jqtree");return t?(l=e(c).find("#jqtree-list-item-"+t),a=e(l).parents("."+i.replacements.list_class)):a=e(c).find(".jqtree-list-container"),a=a.filter(":hidden"),a.slideDown(300,s).closest("."+i.replacements.item_class).removeClass("out").addClass("in").trigger("expanded",c,i,l),this},collapse:function(t,s,l){var a,c,i,r,n=e(this).first().closest(".jqtree-root"),d=n.data("jqtree");return t?(i=e(n).find("#jqtree-list-item-"+t),c=e(i).parents("."+d.replacements.list_class)):c=e(n).find(".jqtree-list-container"),s&&(r=e(n).find("#jqtree-list-item-"+s),c=c.not(e(r).parents("."+d.replacements.list_class))),c=c.filter(":visible"),c.first().slideUp(300,function(){c.hide().closest("."+d.replacements.item_class).removeClass("in").addClass("out").trigger("collapsed",n,d,a),"function"==typeof l&&l.call(this)}),this}},e.fn.jqtree=function(e,t,s,l){return(void 0===e||"object"==typeof e)&&(t=e,e="init"),functions[e].call(this,t,s,l)},e.fn.jqtree.defaults={data:[],expandLevels:2,beforeItemProcess:t,beforeItemRender:t,selectorSelector:".item > .selector",handlerSelector:".item > .handler",replacements:{"class":"jqtree",list_class:"jqtree-list",item_class:"jqtree-item",item_class_empty:"jqtree-empty",item_class_full:"jqtree-full",selected_class:"selected",handler_class:"handler",selector_class:"selector",expanded_class:"expanded",closed_class:"collapsed",handler_expanded_class:"expanded",handler_collapsed_class:"collapsed"},itemReplacements:{"class":"",style:"",ul_style:"",id:""},templates:{list:"<ul class='((class)) ((list_class))'>((items))</ul>",emptyItem:"<li class='((item_class)) ((item_class_empty)) :class' data-id=':id' style=':style' id='jqtree-list-item-:id'><span class='handler empty'></span><span class='((selector_class))'>:text</span></li>",closeItem:"<li class='item list ((item_class)) ((item_class_full)) :class' data-id=':id' style=':style' id='jqtree-list-item-:id'><span class='handler ((handler_collapsed_class))'></span><span class='selector'>:text</span><ul style=':ul_style' class='jqtree-list-container ((list_class))'>:items</ul></li>",openItem:"<li class='item list ((item_class)) ((item_class_full)) :class' data-id=':id' style=':style' id='jqtree-list-item-:id'><span class='handler ((handler_expanded_class))'></span><span class='selector'>:text</span><ul style=':ul_style' class='jqtree-list-container ((list_class))'>:items</ul></li>"},picker:function(e){return e.children},itemRegex:/:\(?([a-zA-Z0-9_]+)\)?/g,listRegex:/\(\(([a-zA-Z0-9_]+)\)\)/g,overrides:{toggle:function(t){var s=e(this).closest(".jqtree-root"),l=s.data("jqtree"),a=e(this).closest("."+l.replacements.item_class),c=a.children().closestChild("."+l.replacements.item_class);return a.hasClass("in")?functions.collapse.call(this,c.data("id"),a.data("id"),function(){a.closestChild(l.handlerSelector).removeClass(l.replacements.handler_expanded_class).addClass(l.replacements.handler_collapsed_class)}):functions.expand.call(this,c.data("id"),function(){a.closestChild(l.handlerSelector).addClass(l.replacements.handler_expanded_class).removeClass(l.replacements.handler_collapsed_class)}),t.preventDefault(),t.stopPropagation(),!1},select:function(t){var s=e(this).closest(".jqtree-root"),l=s.data("jqtree"),a=e(this).closest("."+l.replacements.item_class);return s.jqtree("select",a.data("id")),t.preventDefault(),t.stopPropagation(),!1}}}}(jQuery);