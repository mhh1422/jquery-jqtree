/*Copyright (c) 2015 muhannad. MIT License*/
!function(e){var s=function(){};e.fn.hasOwnProperty("closestChild")||(e.fn.closestChild=function(s,t){if(t&&1==t){var l=e();return this.each(function(){l.pushStack(e(this).closestChild(s,!1))}),l}for(var a=e(),c=this;c.length&&(a=c.filter(s),!a.length);)c=c.children();return a.first()});var t=function(s,l,a,c){var i,n,r,d,o,p=l.picker,m=l.itemRegex,h="";for(i in s){for(n=e.extend(!0,{},l.itemReplacements,s[i]),l.beforeItemProcess(n,l,a,c),r=p(n),"object"==typeof r?a>=l.expandLevels-1&&0!==l.expandLevels?(n.ul_style+=" display: none;",n.class+=" out",d=l.templates.closeItem):(n.class+=" in",d=l.templates.openItem):d=l.templates.emptyItem,n.items=t(r,l,a+1,c),l.beforeItemRender(n,l,a,c),match=m.exec(d);match;)m.lastIndex=0,o=n.hasOwnProperty(match[1])?n[match[1]]:"",d=d.replace(match[0],o),match=m.exec(d);c[n.id]=n,delete s[i],s[i]=n,h+=d}return h};functions={init:function(s){var l,a=e.extend(!0,{},e.fn.jqtree.defaults,s,e.fn.jqtree.defaults.overrides);return this.each(function(){var s,c=e.extend(!0,{},a),i=[];c.replacements.items=t(c.data,c,0,i);var n=c.templates.list;for(s=c.listRegex.exec(n);s;)c.listRegex.lastIndex=0,l=c.replacements.hasOwnProperty(s[1])?c.replacements[s[1]]:"",n=n.replace(s[0],l),s=c.listRegex.exec(n);e(this).html(n),e(this).on("click",c.handlerSelector,c.toggle),e(this).on("click",c.selectorSelector,c.select),c.treeData=i,e(this).addClass("jqtree-root").data("jqtree",c).trigger("ready",c)})},select:function(s,t,l){var a=e(this).first().closest(".jqtree-root"),c=a.data("jqtree"),i=e(a).find("#jqtree-list-item-"+s);return e(a).find("."+c.replacements.selected_class).removeClass(c.replacements.selected_class),e(i).addClass(c.replacements.selected_class),l!==!0&&e(i).trigger("selected",c.treeData[s],a,c),functions.expand.call(this,s,function(){"function"==typeof t&&t.call(this,c.treeData[s],a,c)}),this},expand:function(s,t){var l,a,c=e(this).first().closest(".jqtree-root"),i=c.data("jqtree");return s?(l=e(c).find("#jqtree-list-item-"+s),a=e(l).parents("."+i.replacements.list_class)):a=e(c).find("."+i.replacements.list_class),a=a.filter(":hidden"),a.slideDown(300,function(){e(this).closest("."+i.replacements.item_class).removeClass("out").addClass("in").trigger("expanded",c,i,l).closestChild("."+i.replacements.handler_collapsed_class).addClass(i.replacements.handler_expanded_class).removeClass(i.replacements.handler_collapsed_class),t&&"function"==typeof t&&t.call(this,c,i)}),this},collapse:function(s,t,l){var a,c,i,n,r=e(this).first().closest(".jqtree-root"),d=r.data("jqtree");return s?(i=e(r).find("#jqtree-list-item-"+s),c=e(i).parents("."+d.replacements.list_class)):c=e(r).find("."+d.replacements.list_class),n=e(r).find("#jqtree-list-item-"+(t?t:1)),c=c.not(r.closestChild("."+d.replacements.list_class)).not(e(n).parents("."+d.replacements.list_class)).filter(":visible"),c.slideUp(300,function(){e(this).find("."+d.replacements.list_class).addBack().hide().closest("."+d.replacements.item_class).removeClass("in").addClass("out").trigger("collapsed",r,d,a),e(this).closest("."+d.replacements.item_class).find("."+d.replacements.handler_expanded_class).removeClass(d.replacements.handler_expanded_class).addClass(d.replacements.handler_collapsed_class),l&&"function"==typeof l&&l.call(this,r,d)}),this}},e.fn.jqtree=function(e,s,t,l){return(void 0===e||"object"==typeof e)&&(s=e,e="init"),functions[e].call(this,s,t,l)},e.fn.jqtree.defaults={data:[],expandLevels:2,beforeItemProcess:s,beforeItemRender:s,selectorSelector:".item > .selector",handlerSelector:".item > .handler",replacements:{"class":"jqtree",list_class:"jqtree-list",item_class:"jqtree-item",item_class_empty:"jqtree-empty",item_class_full:"jqtree-full",selected_class:"selected",handler_class:"handler",selector_class:"selector",expanded_class:"expanded",closed_class:"collapsed",handler_expanded_class:"expanded",handler_collapsed_class:"collapsed"},itemReplacements:{"class":"",style:"",ul_style:"",id:""},templates:{list:"<ul class='((class)) ((list_class))'>((items))</ul>",emptyItem:"<li class='((item_class)) ((item_class_empty)) :class' data-id=':id' style=':style' id='jqtree-list-item-:id'><span class='handler empty'></span><span class='((selector_class))'>:text</span></li>",closeItem:"<li class='item list ((item_class)) ((item_class_full)) :class' data-id=':id' style=':style' id='jqtree-list-item-:id'><span class='handler ((handler_collapsed_class))'></span><span class='selector'>:text</span><ul style=':ul_style' class='((list_class))'>:items</ul></li>",openItem:"<li class='item list ((item_class)) ((item_class_full)) :class' data-id=':id' style=':style' id='jqtree-list-item-:id'><span class='handler ((handler_expanded_class))'></span><span class='selector'>:text</span><ul style=':ul_style' class='((list_class))'>:items</ul></li>"},picker:function(e){return e.children},itemRegex:/:\(?([a-zA-Z0-9_]+)\)?/g,listRegex:/\(\(([a-zA-Z0-9_]+)\)\)/g,overrides:{toggle:function(s){var t=e(this).closest(".jqtree-root"),l=t.data("jqtree"),a=e(this).closest("."+l.replacements.item_class),c=a.children().closestChild("."+l.replacements.item_class);return a.hasClass("in")?functions.collapse.call(this,c.data("id"),a.data("id")):functions.expand.call(this,c.data("id")),s.preventDefault(),s.stopPropagation(),!1},select:function(s){var t=e(this).closest(".jqtree-root"),l=t.data("jqtree"),a=e(this).closest("."+l.replacements.item_class);return t.jqtree("select",a.data("id")),s.preventDefault(),s.stopPropagation(),!1}}}}(jQuery);